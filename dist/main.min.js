var d={},h=function(){},f={set:function(t,n){console.log(`Setting state: ${t} =`,n),d[t]=n,h()},get:function(t){return d[t]},getAll:function(){return d}};function p(t){h=t,document.querySelectorAll("state").forEach(function(i){let e=i.getAttribute("id");if(!e)return;let o=i.getAttribute("type")||"string",a=i.getAttribute("value"),r;o==="number"?r=Number(a):o==="boolean"?r=a==="true":o==="json"?r=JSON.parse(a):r=a,d[e]=r})}function v(t,n={},i={}){if(!t)return;let e={...i,...n},o=Object.keys(e),a=Object.values(e);try{return new Function(...o,`return ${t}`)(...a)}catch(r){console.error(`Failed to evaluate expression: "${t}"`,{context:e,error:r});return}}var l=class{constructor(n,i){this.tagHandlers=n,this.globalState=i,this.renderNode=this.renderNode.bind(this),this.evaluate=function(e,o={}){return v(e,o,this.globalState.getAll())}}renderNode(n,i={}){Array.from(n.children).forEach(o=>{let a=o.tagName.toLowerCase(),r=this.tagHandlers[a];r?r(o,i,this):this.renderNode(o,i)})}};function c(t,n,i){let e=null;t.nextElementSibling&&t.nextElementSibling.tagName==="ELSE"&&(e=t.nextElementSibling);let o=t.getAttribute("condition");i.evaluate(o,n)?(t.style.display="",e!==null&&(e.style.display="none"),i.renderNode(t,n)):(t.style.display="none",e!==null&&(e.style.display="",i.renderNode(e,n)))}function g(t,n,i){let e=t.getAttribute("each"),o=t.getAttribute("in");t.template||(t.template=t.innerHTML);let a=i.evaluate(o,n);if(t.innerHTML="",Array.isArray(a)){let r=document.createDocumentFragment();a.forEach(function(x,N){let u={...n};u[e]=x,u.index=N;let s=document.createElement("div");for(s.innerHTML=t.template,i.renderNode(s,u);s.firstChild;)r.appendChild(s.firstChild)}),t.appendChild(r)}}function y(t,n,i){let e=t.getAttribute("for"),o=i.evaluate(e,n);o&&typeof o=="object"&&o.hasOwnProperty("value")?t.textContent=o.value:t.textContent=o}var b=c;function m(t,n,i){let e=!1;if(!t._hasRenderedOnce)e=!0,t._hasRenderedOnce=!0;else{let o=t.getAttribute("condition");e=i.evaluate(o,n)}t.style.display=e?"":"none",e&&i.renderNode(t,n)}window.State=f;document.addEventListener("DOMContentLoaded",function(){let t={value:y,if:c,for:g,while:b,"do-while":m},n=new l(t,f);p(function(){console.log("State changed. Re-rendering the page."),n.renderNode(document.body)}),console.log("System initialized. Performing initial render."),n.renderNode(document.body)});
